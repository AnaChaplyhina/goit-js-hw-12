{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\n// Можеш лишити напряму в коді:\nconst API_KEY = '11281296-1f4fc3f6c48856d743f19a161';\n// або, якщо колись винесеш у .env.local: const API_KEY = import.meta.env.VITE_PIXABAY_KEY;\n\nconst BASE_URL = 'https://pixabay.com/api/';\n\nexport async function getImagesByQuery(query, page) {\n  const params = {\n    key: API_KEY,\n    q: query,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    per_page: 15,\n    page: page,\n  };\n\n  const { data } = await axios.get(BASE_URL, { params });\n  return data;\n}\n\n\n\n\n","import SimpleLightbox from 'simplelightbox';\n\nconst galleryEl = document.querySelector('#gallery');\nconst loaderEl = document.querySelector('#loader');\nconst loadMoreBtn = document.querySelector('#load-more');\n\nconst lightbox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250\n});\n\nexport function createGallery(images) {\n  if (!Array.isArray(images) || images.length === 0) return;\n\n  const frag = document.createDocumentFragment();\n\n  for (let i = 0; i < images.length; i += 1) {\n    const it = images[i];\n\n    const li = document.createElement('li');\n    li.className = 'photo-card';\n\n    const a = document.createElement('a');\n    a.setAttribute('href', it.largeImageURL);\n\n    const img = document.createElement('img');\n    img.setAttribute('src', it.webformatURL);\n    img.setAttribute('alt', escapeHtml(it.tags || ''));\n    img.setAttribute('loading', 'lazy');\n\n    a.appendChild(img);\n    li.appendChild(a);\n\n    const info = document.createElement('div');\n    info.className = 'info';\n    info.appendChild(makeInfoP('Likes', it.likes));\n    info.appendChild(makeInfoP('Views', it.views));\n    info.appendChild(makeInfoP('Comments', it.comments));\n    info.appendChild(makeInfoP('Downloads', it.downloads));\n\n    li.appendChild(info);\n    frag.appendChild(li);\n  }\n\n  galleryEl.appendChild(frag);\n  lightbox.refresh();\n}\n\nexport function clearGallery() {\n  if (galleryEl) galleryEl.innerHTML = '';\n}\nexport function showLoader() {\n  if (loaderEl) loaderEl.classList.remove('is-hidden');\n}\nexport function hideLoader() {\n  if (loaderEl) loaderEl.classList.add('is-hidden');\n}\nexport function showLoadMoreButton() {\n  if (loadMoreBtn) loadMoreBtn.classList.remove('is-hidden');\n}\nexport function hideLoadMoreButton() {\n  if (loadMoreBtn) loadMoreBtn.classList.add('is-hidden');\n}\nexport function getFirstCardHeight() {\n  const first = galleryEl ? galleryEl.querySelector('.photo-card') : null;\n  return first ? first.getBoundingClientRect().height : 0;\n}\n\nexport { galleryEl, loadMoreBtn };\n\nfunction makeInfoP(label, value) {\n  const p = document.createElement('p');\n  const b = document.createElement('b');\n  b.textContent = label;\n  p.appendChild(b);\n  p.appendChild(document.createTextNode(String(value)));\n  return p;\n}\nfunction escapeHtml(str) {\n  return String(str)\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\n","import 'izitoast/dist/css/iziToast.min.css';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport iziToast from 'izitoast';\nimport { getImagesByQuery } from './js/pixabay-api.js';\nimport {\n  createGallery,\n  clearGallery,\n  showLoader,\n  hideLoader,\n  showLoadMoreButton,\n  hideLoadMoreButton,\n  getFirstCardHeight,\n  loadMoreBtn\n} from './js/render-functions.js';\n\nvar form, input;\nvar currentQuery = '';\nvar page = 1;\nvar totalHits = 0;\nvar totalLoaded = 0;\n\nready(init);\n\nfunction init() {\n  form = document.querySelector('#search-form');\n  input = form ? form.elements.query : null;\n\n  if (!form || !input) {\n    console.error('search form not found in DOM');\n    return;\n  }\n\n  form.addEventListener('submit', onSearchSubmit);\n  if (loadMoreBtn) loadMoreBtn.addEventListener('click', onLoadMore);\n\n  // авто-пошук із ?query=...\n  var params = new URLSearchParams(window.location.search);\n  var q = params.get('query');\n  if (q && q.trim()) {\n    input.value = q.trim();\n    onSearchSubmit(new Event('submit', { bubbles: false, cancelable: true }));\n  }\n}\n\nasync function onSearchSubmit(e) {\n  if (e && typeof e.preventDefault === 'function') e.preventDefault();\n\n  var query = input ? String(input.value).trim() : '';\n\n  hideLoadMoreButton();\n  clearGallery();\n  totalLoaded = 0;\n  totalHits = 0;\n  page = 1;\n\n  if (!query) {\n    iziToast.warning({\n      message: 'Введи ключове слово для пошуку.',\n      position: 'topRight'\n    });\n    return;\n  }\n\n  currentQuery = query;\n\n  try {\n    showLoader();\n    const data = await getImagesByQuery(currentQuery, page);\n\n    if (!data || !data.hits || data.hits.length === 0) {\n      iziToast.info({\n        message: 'На жаль, нічого не знайдено. Спробуй інший запит.',\n        position: 'topRight'\n      });\n      return;\n    }\n\n    totalHits = Number(data.totalHits || 0);\n    createGallery(data.hits);\n    totalLoaded += data.hits.length;\n\n    if (totalLoaded < totalHits) {\n      showLoadMoreButton();\n    } else {\n      iziToast.info({\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: 'bottomCenter'\n      });\n    }\n  } catch (err) {\n    showErrorToast(err);\n    console.error(err);\n  } finally {\n    hideLoader();\n  }\n}\n\nasync function onLoadMore() {\n  page += 1;\n\n  try {\n    showLoader();\n    const data = await getImagesByQuery(currentQuery, page);\n\n    if (!data || !data.hits || data.hits.length === 0) {\n      hideLoadMoreButton();\n      iziToast.info({\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: 'bottomCenter'\n      });\n      return;\n    }\n\n    createGallery(data.hits);\n    totalLoaded += data.hits.length;\n\n    var h = getFirstCardHeight();\n    if (h) {\n      window.scrollBy({ top: h * 2, behavior: 'smooth' });\n    }\n\n    if (totalLoaded >= totalHits) {\n      hideLoadMoreButton();\n      iziToast.info({\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: 'bottomCenter'\n      });\n    }\n  } catch (err) {\n    showErrorToast(err);\n    console.error(err);\n  } finally {\n    hideLoader();\n  }\n}\n\nfunction showErrorToast(err) {\n  var msg = 'Unknown error';\n  if (err && err.code === 'NO_PIXABAY_KEY') {\n    msg = 'Pixabay API key is not set. Додай ключ у src/js/pixabay-api.js або в .env.local як VITE_PIXABAY_KEY.';\n  } else if (err && err.response) {\n    var status = err.response.status;\n    var respMsg =\n      (err.response.data && err.response.data.message)\n        ? err.response.data.message\n        : (err.response.statusText ? err.response.statusText : 'Request failed');\n    msg = 'HTTP ' + status + ': ' + respMsg;\n  } else if (err && err.request) {\n    msg = 'Network error: no response from server';\n  } else if (err && err.message) {\n    msg = err.message;\n  }\n  iziToast.error({ title: 'Помилка', message: msg, position: 'topRight' });\n}\n\n// helper: run when DOM ready\nfunction ready(cb) {\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', cb);\n  } else {\n    cb();\n  }\n}\n\n\n\n\n"],"names":["API_KEY","BASE_URL","getImagesByQuery","query","page","params","data","axios","galleryEl","loaderEl","loadMoreBtn","lightbox","SimpleLightbox","createGallery","images","frag","i","it","li","a","img","escapeHtml","info","makeInfoP","clearGallery","showLoader","hideLoader","showLoadMoreButton","hideLoadMoreButton","getFirstCardHeight","first","label","value","p","b","str","form","input","currentQuery","totalHits","totalLoaded","ready","init","onSearchSubmit","onLoadMore","q","iziToast","err","showErrorToast","h","msg","status","respMsg","cb"],"mappings":"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"}